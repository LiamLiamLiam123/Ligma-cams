<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ligma-cams</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #0f0;
  font-family: Arial, sans-serif;
  color: #000;
}

header {
  padding: 10px;
  background: #090;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

h1 {
  margin: 0;
  text-align: center;
}

#search {
  padding: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}

#grid {
  padding: 8px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 8px;
}

.cam {
  background: #0c0;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
}

.cam img {
  width: 100%;
  display: block;
}

.cam div {
  padding: 6px;
  font-size: 14px;
  text-align: center;
}

#empty {
  text-align: center;
  opacity: 0.6;
  margin-top: 20px;
  display: none;
}

/* FULLSCREEN */
#fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: #000;
  display: none;
  z-index: 9999;
}

#fullscreen img {
  width: 100vw;
  height: 100vh;
  object-fit: contain; /* change to cover if you want crop-fill */
}

#closeBtn {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 10000;
  background: rgba(0,0,0,0.7);
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  font-size: 18px;
  cursor: pointer;
}

@media (min-width: 768px) {
  header {
    flex-direction: row;
    align-items: center;
  }
  h1 {
    flex: 1;
    text-align: left;
  }
  #search {
    flex: 2;
  }
}
</style>
</head>

<body>

<header>
  <h1>ðŸš¦ ligma-cams</h1>
  <input id="search" placeholder="Search by location">
</header>

<div id="grid"></div>
<div id="empty">Loading camerasâ€¦</div>

<div id="fullscreen">
  <button id="closeBtn" onclick="closeFullscreen()">âœ•</button>
  <img id="fs-img">
</div>

<script>
/* FREE CORS PROXY */
const CAMS_JSON =
  "https://api.allorigins.win/raw?url=" +
  encodeURIComponent(
    "https://raw.githubusercontent.com/LiamLiamLiam123/cams-json/main/cams.json"
  );

const grid = document.getElementById("grid");
const empty = document.getElementById("empty");
const search = document.getElementById("search");
const fs = document.getElementById("fullscreen");
const fsImg = document.getElementById("fs-img");

let cameras = [];
let fsCam = null;

/* LOAD CAMERAS */
async function loadCameras() {
  try {
    empty.style.display = "block";
    empty.textContent = "Loading camerasâ€¦";

    const res = await fetch(CAMS_JSON);
    const text = await res.text();
    const data = JSON.parse(text);

    cameras = data.features.map(f => ({
      location: f.properties.title + " - " + f.properties.view,
      url: f.properties.href
    }));

    render();
  } catch (e) {
    console.error(e);
    empty.textContent = "Failed to load cameras";
  }
}

/* RENDER GRID */
function render() {
  const q = search.value.toLowerCase();
  grid.innerHTML = "";

  const filtered = cameras.filter(c =>
    c.location.toLowerCase().includes(q)
  );

  empty.style.display = filtered.length ? "none" : "block";

  filtered.forEach(cam => {
    const card = document.createElement("div");
    card.className = "cam";
    card.innerHTML = `
      <img src="${cam.url}?_=${Date.now()}">
      <div>${cam.location}</div>
    `;
    card.onclick = () => openFullscreen(cam);
    grid.appendChild(card);
  });
}

/* FULLSCREEN */
function openFullscreen(cam) {
  fsCam = cam;
  fs.style.display = "block";
  updateFullscreenImage();
}

function closeFullscreen() {
  fs.style.display = "none";
  fsCam = null;
}

function updateFullscreenImage() {
  if (fsCam) {
    fsImg.src = fsCam.url + "?_=" + Date.now();
  }
}

/* SEARCH */
search.addEventListener("input", render);

/* AUTO REFRESH EVERY 15s */
setInterval(() => {
  render();
  if (fsCam) updateFullscreenImage();
}, 15000);

/* INIT */
loadCameras();
</script>

</body>
</html>
